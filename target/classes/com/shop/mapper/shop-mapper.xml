<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shop.mapper.ShopMapper">
	
	<sql id="productColumns">title, price, count, content, category, productName, color, size, managerId</sql>
	<sql id="cartColumns">productNo, count, price, productName, color, size, memberId</sql>

	<resultMap id="categoryMap" type="java.util.HashMap">
        <result javaType="java.lang.String" column="category" property="categoryName"/>
        <result javaType="java.lang.Integer" column="categoryCnt" property="categoryCnt"/>
	</resultMap>
	
	<resultMap id="colorMap" type="java.util.HashMap">
        <result javaType="java.lang.String" column="color" property="colorName"/>
        <result javaType="java.lang.Integer" column="colorCnt" property="colorCnt"/>
	</resultMap>
	
	<!-- Product -->
	
	<select id="selectProductByProductNo" resultType="Product">
		select productNo, regDate, <include refid="productColumns"/> from product where productNo = #{ productNo }  
	</select>
	
	<select id="selectProducts" resultType="Product">
		select productNo, regDate, <include refid="productColumns"/> from product
	</select>
	
	<select id="selectCategories" resultMap="categoryMap">
		select category, count(category) categoryCnt from product group by category
	</select>
	
	<select id="selectColors" resultMap="colorMap">
		select color, count(color) colorCnt from product group by color
	</select>
	
	<!-- Cart -->
	
	<select id="selectCarts" resultType="Cart">
		select cartNo, regDate, <include refid="cartColumns"/> from cart
	</select>
	
	<insert id="insertCart" parameterType="Cart" >
		insert into cart(
			<include refid="cartColumns"/>
		) values(
			#{ productNo },
			#{ count },
			#{ price },
			#{ productName }, 
			#{ color },
			#{ size },
			#{ memberId }
		)
	</insert>
	
	<delete id="deleteCart">
		delete from cart where cartNo = #{ cartNo }
	</delete>
	
	<update id="updateCartCntByCartNo" parameterType="hashmap">
		update cart set count = #{ count } where cartNo = #{ cartNo }	
	</update>
	
</mapper>
