<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shop.mapper.ShopMapper">
	
	<sql id="productColumns">title, price, count, content, category, productName, color, size, managerId</sql>
	<sql id="cartColumns">productNo, count, price, productName, color, size, memberId</sql>

	<resultMap id="categoryMap" type="java.util.HashMap">
        <result javaType="java.lang.String" column="category" property="categoryName"/>
        <result javaType="java.lang.Integer" column="categoryCnt" property="categoryCnt"/>
	</resultMap>
	
	<resultMap id="colorMap" type="java.util.HashMap">
        <result javaType="java.lang.String" column="color" property="colorName"/>
        <result javaType="java.lang.Integer" column="colorCnt" property="colorCnt"/>
	</resultMap>
	
	<!-- <resultMap id="cartListMap" type="java.util.HashMap">
		<result javaType="String" column="title" property="title"/>
		<result javaType="int" column="cartNo" property="cartNo"/>
		<result javaType="int" column="productNo" property="productNo"/>
		<result javaType="int" column="count" property="count"/>
		<result javaType="int" column="price" property="price"/>
		<result javaType="String" column="productName" property="productName"/>
		<result javaType="String" column="color" property="color"/>
		<result javaType="String" column="size" property="size"/>
		<result javaType="java.util.Date" column="regDate" property="regDate"/>
		<result javaType="String" column="memberId" property="memberId"/>
	</resultMap> -->
	
	<!-- Product -->
	
	<select id="selectProductByProductNo" resultType="Product">
		select productNo, regDate, <include refid="productColumns"/> from product where productNo = #{ productNo }  
	</select>
	
	<select id="selectProducts" resultType="Product">
		select productNo, regDate, <include refid="productColumns"/> from product
	</select>
	
	<select id="selectCategories" resultMap="categoryMap">
		select category, count(category) categoryCnt from product group by category
	</select>
	
	<select id="selectColors" resultMap="colorMap">
		select color, count(color) colorCnt from product group by color
	</select>
	
	<!-- Cart -->
	
	<select id="selectCarts" resultType="Cart">
		select p.title, cartNo, c.regDate, c.productNo, c.count, c.price, c.productName, c.color, c.size, memberId
		from product p inner join cart c 
		on p.productNo = c.productNo
		where memberId = #{ memberId }
	</select>
	
	<insert id="insertCart" parameterType="Cart" >
		insert into cart(
			<include refid="cartColumns"/>
		) values(
			#{ productNo },
			#{ count },
			#{ price },
			#{ productName }, 
			#{ color },
			#{ size },
			#{ memberId }
		)
	</insert>
	
	<delete id="deleteCart" >
		delete from cart 
		where 
		<choose>
            <when test="codeList.size != 0">
                cartNos in 
                <foreach collection="codeList" item="item" index="index" separator="," open="(" close=")">
                    #{item}
                </foreach>
            </when>
        </choose>
	</delete>
	
	<update id="updateCartCntByCartNo" parameterType="hashmap">
		update cart set count = #{ count } where cartNo = #{ cartNo }	
	</update>
	
	<!-- CheckOut -->
	<select id="selectCheckoutList" resultType="Cart">
		select p.title, cartNo, c.regDate, c.productNo, c.count, c.price, c.productName, c.color, c.size, memberId
		from product p inner join cart c 
		on p.productNo = c.productNo
		where memberId = #{ memberId }
		<choose>
            <when test="codeList.size != 0">
                and cartNo in 
                <foreach collection="codeList" item="item" index="index" separator="," open="(" close=")">
                    #{item}
                </foreach>
            </when>
        </choose>
	</select>
</mapper>
